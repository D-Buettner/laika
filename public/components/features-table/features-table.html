<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="features-table">
  <template>
    <iron-ajax auto
        url=[[featuresUrl]]
        handle-as="json"
        last-response="{{featuresData}}"></iron-ajax>

    <iron-ajax auto
        url=[[environmentsUrl]]
        handle-as="json"
        last-response="{{environmentsData}}"></iron-ajax>

    <table>
      <tr>
        <th></th>
        <template is="dom-repeat" items="[[environmentsData]]">
          <th>[[item.name]]</th>
        </template>
      </tr>
      <template is="dom-repeat" items="[[featuresData]]" as="f">
        <tr>
          <td><a href="/feature-page/[[f.name]]">[[f.name]]</a></td>
          <template is="dom-repeat" items="[[environmentsData]]" as="e">
            <td>
              <template is="dom-if" if="[[!getValue(f.status, e.name)]]">
                <input type="checkbox" name="status" value="false" disabled>
              </template>
              <template is="dom-if" if="[[getValue(f.status, e.name)]]">
                <input type="checkbox" name="status" value="true" disabled checked>
              </template>
            </td>
          </template>
        </tr>
      </template>
    </table>
  </template>

  <script>
  Polymer({
    is: 'features-table',

    ready: function() {
      this.environmentsUrl = window.config.apiServer + '/api/environments';
      this.featuresUrl = window.config.apiServer + '/api/features';
    },

    getValue: function(obj, key) {
      return obj[key];
    }
  });
  </script>
</dom-module>
